{% extends "network/layout.html" %}
{% load static %}
{% block title %}: {{ pagename }}{% endblock title%}

{% block body %}

{% if posts %}
    {% for post in page %}
        <div class="post">
            <a href="{% url "userpage" post.user.id %}"><h2>{{ post.user.username }}</h2></a>
            <h3 id="post-content-{{post.id}}">{{ post.content }}</h3>
            <ul class="likeul">
                <li>
                    <h3 id="likeButton{{ post.id }}"><a onclick="likepost(`{{ post.id }}`)">❤️ </a></h3>
                </li>
                <li>
                    <h3 id="likes{{ post.id }}">{{ post.likes }}</h3>
                </li>
            </ul>
            <h6 style="color: gray;text-align: right; visibility: hidden;" id="editedtag{{ post.id }}">(edited)</h1>  
                {% if post.edited %}
                <script>
                    document.querySelector(`#editedtag{{ post.id }}`).style.visibility = "visible";
                </script>
                {% endif %}
            <h5 style="text-align: right;">{{ post.creation_date }}</h5>
        </div>
    {% endfor %}
        {% else %}
            <center><h1 style="color: red; font-weight: Bolder; font-size: 900%;padding: 70px 0;">No posts :(</h1></center>
    {% endif %}
    <hr><br><br>
    <div class="pagination" style="display: inline;">
     <center>{% if page.has_previous %}
        <a href="?page=1">&laquo First</a>
        <a href="?page={{ page.previous_page_number}}">Previous</a>
     {% endif %}
     Page {{ page.number }} of {{page.paginator.num_pages}}
     {% if page.has_next %}
     <a href="?page={{ page.next_page_number }}">Next</a>
        <a href="?page={{ page.paginator.num_pages }}">Last &raquo</a>
     {% endif %}</center>
     <br></div>
     <script>
        async function SaveNewContent(id) {
            new_content = document.querySelector(`#edited_content_${id}`).value
            response = await fetch(`/edit/${id}`, {
                                    method: 'POST',
                                    body: JSON.stringify({
                                        'new_content': new_content,
                                    }),
                                })
            result = await response.json()
            const modal = document.querySelector(`#edit_${id}`)
            const content = document.querySelector(`#post-content-${id}`)
            content.innerHTML = result.content
            document.querySelector(`#editedtag${id}`).style.visibility = "visible";


        }          
        async function likepost(id) {           
            response = await fetch(`/like/${id}`, {
                                    method: 'POST',
                                    body: JSON.stringify({
                                        'like': 'yealike',
                                    }),
                                })
            result = await response.json()
            const likecounter = document.querySelector(`#likes${id}`)
            likecounter.innerHTML = result.likes
            if (result.animation == 'like') {
                document.querySelector(`#likeButton${id}`).className = 'box'
            } else {
                document.querySelector(`#likeButton${id}`).className = 'box2'
            }
        }  
     </script>

{% endblock %}